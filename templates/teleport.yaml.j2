teleport:
  nodename: {{ teleport_nodename }}
  pid_file: {{ teleport_pidfile }}
{% if teleport_ca_pin %}
  ca_pin: "{{ teleport_ca_pinÂ }}"
{% endif %}
{% if teleport_auth_token %}  
  auth_token: "{{ teleport_auth_token }}"
{% endif %}
{% if teleport_advertise_ip | default(false) %}
  advertise_ip: "{{ teleport_advertise_ip }}"
{% endif %}
  auth_servers:
{% for auth_server in teleport_auth_servers %}
    - "{{ auth_server }}"
{% endfor %}
  connection_limits:
    max_connections: 1000
    max_users: 250
  log:
    output: syslog
    severity: {{ teleport_log_level }}
  storage:
    type: {{ teleport_storage_type }}
{% if teleport_storage_region | default(false) %}
    region: "{{ teleport_storage_region }}"
{% endif %}
{% if teleport_audit_events_uri | default(false) %}
    audit_events_uri: "{{ teleport_audit_events_uri }}"
{% endif %}
{% if teleport_storage_table_name | default(false) %}
    table_name: "{{ teleport_storage_table_name }}"
{% endif %}
{% if teleport_audit_sessions_uri | default(false) %}
    audit_sessions_uri: "{{ teleport_audit_sessions_uri }}"
{% endif %}
  data_dir: {{ teleport_data_dir }}
auth_service:
{% if teleport_auth_enabled | default(false) %}
  enabled: "yes"
  listen_addr: "{{ teleport_auth_listen_address }}"
  authentication:
    type: local
{% if teleport_second_factor_otp | default(false) %}
    second_factor: otp
{% elif teleport_u2f_app_id | default(false) %}
    second_factor: u2f
    u2f:
      app_id: "{{ teleport_u2f_app_id }}"
      facets:
        - "{{ teleport_u2f_app_id }}"
{% endif %}
  oidc_connectors: []
  cluster_name: {{ teleport_auth_cluster_name }}
{% if teleport_auth_public_addr %}
  public_addr: "{{ teleport_auth_public_addr }}"
{% endif %}
{% if teleport_auth_trusted_clusters|length > 0 %}
  trusted_clusters:
{% for cluster_ca in teleport_auth_trusted_clusters %}
    - key_file: {{ cluster_ca }}
{% endfor %}
{% endif %}
{% if teleport_auth_tokens_node|length > 0 or teleport_auth_tokens_proxy|length > 0 or teleport_auth_tokens_auth|length > 0 %}
  tokens:
{% for token in teleport_auth_tokens_node %}
    - "node:{{ token }}"
{% endfor %}
{% for token in teleport_auth_tokens_proxy %}
    - "proxy:{{ token }}"
{% endfor %}
{% for token in teleport_auth_tokens_auth %}
    - "auth:{{ token }}"
{% endfor %}
{% endif %}
{% else %}
  enabled: "no"
{% endif %}
ssh_service:
{% if teleport_ssh_enabled | default(false) %}
  enabled: "yes"
  listen_addr: "{{ teleport_ssh_listen_address }}"
{% if teleport_ssh_labels %}
  labels:
    {{ teleport_ssh_labels }}
{% endif %}
{% else %}
  enabled: "no"
{% endif %}
proxy_service:
{% if teleport_proxy_enabled | default(false) %}
  enabled: "yes"
  listen_addr: "{{ teleport_proxy_listen_address }}"
  web_listen_addr: "{{ teleport_proxy_web_listen_address }}"
  tunnel_listen_addr: "{{ teleport_proxy_tunnel_listen_address }}"
{% if teleport_public_addr %}
  public_addr: "{{ teleport_public_addr }}"
{% endif %}
{% if teleport_ssh_public_addr %}
  ssh_public_addr: "{{ teleport_ssh_public_addr }}"
{% endif %}
{% if teleport_tunnel_public_addr %}
  tunnel_public_addr: "{{ teleport_tunnel_public_addr }}"
{% endif %}
{% if teleport_proxy_https_key_file and teleport_proxy_https_cert_file %}
  https_keypairs:
    - key_file: {{ teleport_proxy_https_key_file }}
      cert_file: {{ teleport_proxy_https_cert_file }}
{% else %}
  https_keypairs: []
{% endif %}
{% if teleport_acme_email %}
  acme:
    enabled: "yes"
    email: "{{ teleport_acme_email }}"
{% endif %}
{% else %}
  enabled: "no"
{% endif %}

